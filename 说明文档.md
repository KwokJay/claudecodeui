# 项目说明文档（Skeleton）

> 维护要求：本文件为项目全生命周期的唯一管理载体。每次开始开发前先阅读并更新；每完成一项任务后，立即在“进度记录”中标记完成并补充结果说明。

---

## 一、项目规划

- 项目名称：待定
- 产品愿景：待定（一句话描述项目给用户带来的核心价值）
- 关键目标（本期）：
  1. 待定
  2. 待定
- 范围（In Scope）：
  - 待定
- 非范围（Out of Scope）：
  - 待定
- 里程碑（时间节点须可交付）：
  - M1：待定（YYYY-MM-DD）
  - M2：待定（YYYY-MM-DD）
- 约束与依赖：
  - 环境：Mac（统一开发环境）
  - 依赖：待定
- 质量要求：
  - 代码规范：所有函数必须有函数级注释（功能、参数、返回值）
  - 测试与自检：提交前自测通过；问题优先用官方/权威文档核对

---

## 二、实施方案（高层）

- 架构概览：
  - 前端：Vite + React + Tailwind（已确认）
  - 桌面：Electron（`electron/`）
  - 服务端：Node.js/Express（`server/`，已确认）
  - 数据存储：SQLite（better-sqlite3）+ 文件（`server/database/`，已确认）
- 模块划分：
  - Web UI：`src/`
  - 桌面主进程：`electron/main.mjs`
  - Server API：`server/`
- 关键用例与流程：
  - 用例1：待定
  - 用例2：待定
- 风险与对策（滚动维护）：
  - 风险：待定 → 对策：待定
  - 风险：许可证不一致（`package.json=MIT`，`LICENSE=GPLv3`） → 对策：当前仅记录不一致（不改代码）；后续可选方案：A 统一为 GPLv3（改 `package.json` 为 `GPL-3.0-or-later`）；B 统一为 MIT（替换根 LICENSE 为 MIT）；C 保持不变但限制对外分发；复核日期：2025-09-01；负责人：待定

---

## 三、进度记录（滚动维护）

| 日期 | 事项 | 状态 | 负责人 | 结果/备注 |
|---|---|---|---|---|
| 2025-09-01 | 创建「说明文档.md」骨架 | 完成 | 待定 | 初始化三大模块 |
| 2025-09-01 | 服务器端口配置核验 | 完成 | 待定 | 开发：PORT=3001、VITE=5173；生产：动态端口（`port:0`），host=`127.0.0.1`；依据 `server/index.js`、`electron/main.mjs`、`.env.example` |
| 2025-09-01 | Electron 图标路径核验 | 完成 | 待定 | 运行时：`public/app-icon.svg`；打包：`public/app-icon-1024.png`；两者均存在于 `public/` |
| 2025-09-01 | 许可证不一致已记录 | 已记录 | 待定 | `package.json=MIT`，`LICENSE=GPLv3`；暂不改动代码，待后续统一决策 |
| 2025-09-01 | 文档整合与合规计划已落盘 | 完成 | 待定 | 新增“当前迭代计划-文档整合与合规”、许可证统一决策准备、Vite 代理与动态端口策略记录 |

---

## 四、当前迭代计划 — 文档整合与合规（仅文档，不改代码/许可证）

- 迭代目标：
  - 整合现有专题文档要点，确立《说明文档.md》为唯一权威入口；
  - 记录许可证统一决策准备；
  - 梳理 Vite 代理与动态端口策略（仅文档，不触及实现）。

- 文档要点清单（来源引用）：
  - `docs/COMMANDS.md`（命令系统：16 个预定义命令 + 自定义命令管理、使用指南与实现要点）
  - `docs/desktop-migration-plan.md`、`docs/desktop-electron-feasibility-and-issues.md`（生产统一走本地服务 HTTP、动态端口、仅 `127.0.0.1`、APP_DATA_DIR、fix-path、asarUnpack 原生模块）
  - `docs/desktop-development-tasks.md`、`docs/桌面改造问题清单与修复建议-20250828105552.md`（开发/生产流程、单实例与端口、Vite 代理一致性、/api/config 动态 WS 推导）

- 待办映射（与项目 ToDoList 对齐）：
  - `doc-plan-section`：在本文件新增本节（当前任务）
  - `docs-readme-pointer`：更新 `docs/README.md`，将 `../CLAUDE.md` 指向改为 `../说明文档.md`，并声明其为权威入口
  - `license-decision-brief`：准备 MIT vs GPLv3 决策材料（本轮仅搭框架，不决策）
  - `vite-ws-doc-audit`：记录 Vite 代理与 `/api/config` 动态端口策略的现状与差距（仅文档）

- 验收标准：
  - 本文件新增本节及两项记录性小节；
  - `docs/README.md` 主索引指向 `../说明文档.md`，并明确其为唯一权威入口；
  - 不修改任何源代码与许可文件。

### 4.1 许可证统一决策准备（文档）

- 现状：`package.json` 标注 MIT；根 `LICENSE` 为 GPLv3（不一致）。
- 选项：
  - 方案 A：统一为 GPLv3（修改 `package.json: license` 为 `GPL-3.0-or-later`）
  - 方案 B：统一为 MIT（替换根 `LICENSE` 为 MIT 文本）
  - 方案 C：暂维持不一致，限制对外分发，待后续统一
- 影响面：分发与合规、第三方依赖兼容性、社区贡献预期。
- 本轮承诺：仅准备对比要点与风险提示，不进行任何改动。

### 4.2 Vite 代理与动态端口策略（记录）

- 建议（文档层面记录）：
  - 开发代理统一：`vite.config.js` 的 `/ws` 与 `/shell` 代理到同一后端端口（如 `PORT || 3001`）；
  - `/api/config` 推导 `wsUrl` 时基于 `req.headers.host` 与协议，避免依赖模块内常量端口；
  - 生产绑定地址维持 `127.0.0.1`，桌面形态仅本机可访问（安全基线）。

---

## 五、规范与流程（遵循）

- 工作流：研究 → 构思 → 计划 → 执行 → 评审（或快速模式）
- 文档管理：
  - 每次开发前先阅读并同步本文件
  - 任何范围/时间调整必须先更新本文件
  - 任务完成后立即更新“进度记录”
- 问题解决：
  - 优先查 Context7 与官方文档；确保准确合规
- 三大“绝不允许”：延期、超出计划、出错

---

## 六、附录（可选）

- 术语表：待定
- 参考链接：`README.md`、`docs/`
